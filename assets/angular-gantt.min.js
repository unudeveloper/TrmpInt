/*! angular-gantt 02-11-2013 */
var gantt=angular.module("gantt",[]);gantt.directive("gantt",["Gantt","dateFunctions",function(a,b){return{restrict:"EA",replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/gantt.tmpl.html":b.templateUrl},scope:{viewScale:"=?",viewScaleFactor:"=?",sortMode:"=?",autoExpand:"=?",fromDate:"=?",toDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",maxHeight:"=?",data:"=?",loadData:"&",removeData:"&",clearData:"&",onGanttReady:"&",onRowAdded:"&",onRowClicked:"&",onRowUpdated:"&",onScroll:"&",onTaskClicked:"&"},controller:["$scope","$element","$timeout",function(c,d,e){c.gantt=new a,c.viewScaleFactor=2,c.ganttInnerWidth=0,void 0===c.autoExpand&&(c.autoExpand=!1),void 0===c.sortMode&&(c.sortMode="name"),void 0===c.viewScale&&(c.viewScale="day"),void 0===c.viewScaleFactor&&(c.viewScaleFactor=2),void 0===c.firstDayOfWeek&&(c.firstDayOfWeek=1),void 0===c.maxHeight&&(c.maxHeight=0),void 0===c.weekendDays&&(c.weekendDays=[0,6]),c.isViewHour=function(){return"hour"===c.viewScale},c.isViewDay=function(){return"day"===c.viewScale},c.isWeekend=function(a){for(var b=0,d=c.weekendDays.length;d>b;b++)if(c.weekendDays[b]===a)return!0;return!1},c.viewMonthFilter=function(a){return(1===a.fromDate.getDate()||a===c.gantt.getFirstColumn())&&0===a.fromDate.getHours()},c.viewWeekFilter=function(a){return(a.fromDate.getDay()===c.firstDayOfWeek||a===c.gantt.getFirstColumn())&&0===a.fromDate.getHours()},c.viewDayFilter=function(a){return 0===a.fromDate.getHours()||a===c.gantt.getFirstColumn()},c.viewColumnFilter=function(a){return c.isViewHour()?!0:c.viewDayFilter(a)},c.swapRows=function(a,b){c.gantt.swapRows(a,b),c.raiseRowUpdated(a),c.raiseRowUpdated(b),"custom"!==c.sortMode?c.sortMode="custom":c.sortRows()},c.$watch("sortMode",function(a,b){angular.equals(a,b)||c.sortRows()}),c.$watch("viewScaleFactor",function(a,b){angular.equals(a,b)||(c.viewScaleFactor=a,c.updateBounds())}),c.$watch("data",function(a,b){angular.equals(a,b)||(c.removeAllData(),c.setData(a))}),c.sortRows=function(){c.gantt.sortRows(c.sortMode)},c.$watch("viewScale",function(a,b){angular.equals(a,b)||c.updateBounds()}),c.$watch("firstDayOfWeek+weekendDays",function(a,b){angular.equals(a,b)||c.updateBounds()}),c.updateBounds=function(){var a,b;for(a=0,b=c.gantt.columns.length;b>a;a++)c.updateColumnBounds(c.gantt.columns[a]);for(a=0,b=c.gantt.rows.length;b>a;a++)for(var d=c.gantt.rows[a],e=0,f=d.tasks.length;f>e;e++)c.updateTaskBounds(d.tasks[e]);c.ganttInnerWidth=(c.isViewDay()?c.gantt.columns.length/24:c.gantt.columns.length)*c.viewScaleFactor},c.calcWidth=function(a){return c.isViewHour()?a*c.viewScaleFactor/36e5:a*c.viewScaleFactor/864e5},c.updateTaskBounds=function(a){a.x=c.calcTaskX(a),a.width=c.calcTaskWidth(a)},c.calcTaskX=function(a){return c.calcWidth(a.from-c.gantt.getFirstColumn().fromDate)},c.calcTaskWidth=function(a){var d;if(a.from===a.to)d=c.isViewDay()?c.viewScaleFactor/24:c.viewScaleFactor;else if(d=c.calcWidth(a.to-a.from),c.isViewDay()&&d<c.viewScaleFactor/2){var e=b.addHours(a.to,12,!0),f=b.setTimeZero(b.addDays(a.to,1,!0));d=e-f>0?c.calcWidth(f-a.from):c.viewScaleFactor/2}return d},c.updateColumnBounds=function(a){c.viewMonthFilter(a)&&(a.widthMonth=c.calcColWidth(a,"month")),c.viewWeekFilter(a)&&(a.widthWeek=c.calcColWidth(a,"week")),a.widthDay=c.isViewHour()?c.calcColWidth(a,"day"):c.viewScaleFactor,a.isWeekend=c.isWeekend(a.fromDate.getDay()),a.toDate=c.isViewHour()?b.addHours(a.fromDate,1,!0):b.addDays(a.fromDate,1,!0)},c.calcColWidth=function(a,d){var e,f=c.calcWidth(b.addHours(a.fromDate,1,!0)-a.fromDate),g=c.gantt.getLastColumn().fromDate,h=a.fromDate;if("hour"===d)return f;if("day"===d){if(c.isViewHour()){var i=b.addHours(a.fromDate,24,!0)>g?g.getHours()+1:24;return f*i}if(c.isViewDay())return 24*f}else{if("week"===d){h=a.fromDate;var j=b.setToDayOfWeek(h,c.firstDayOfWeek,!0),k=b.addWeeks(j,1);return e=k>g?b.addHours(g,1,!0):k,h.getTimezoneOffset()!==e.getTimezoneOffset()&&b.addMinutes(e,h.getTimezoneOffset()-e.getTimezoneOffset()),c.calcWidth(e-h)}if("month"===d){h=a.fromDate;var l=b.addMonths(b.setToFirstDayOfMonth(h,!0),1);return e=l>g?b.addHours(g,1,!0):l,h.getTimezoneOffset()!==e.getTimezoneOffset()&&b.addMinutes(e,h.getTimezoneOffset()-e.getTimezoneOffset()),c.calcWidth(e-h)}}},c.autoExpandColumns=function(a,b,d){if(c.autoExpand===!0){var e=0===a.scrollLeft?(d-b)*a.scrollWidth/(c.gantt.getLastColumn().fromDate-c.gantt.getFirstColumn().fromDate):a.scrollLeft;c.expandColumnRange(b,d),c.updateBounds(),a.scrollLeft=e}},c.raiseRowAdded=function(a){c.onRowAdded({event:{row:a.clone()}})},c.calcDate=function(a){var d,e=c.ganttScroll.children()[0].offsetWidth/c.ganttInnerWidth;d=c.isViewHour()?a/(c.viewScaleFactor*e/36e5):a/(c.viewScaleFactor*e/864e5);var f=b.addMilliseconds(c.gantt.getFirstColumn().fromDate,d,!0);return f},c.getOffset=function(a){if(a.layerX&&a.layerY)return{x:a.layerX,y:a.layerY};var b,c,d=a.target;for(b=c=0;d&&!isNaN(d.offsetLeft)&&!isNaN(d.offsetTop);)b+=d.offsetLeft-d.scrollLeft,c+=d.offsetTop-d.scrollTop,d=d.offsetParent;return b=a.clientX-b,c=a.clientY-c,{x:b,y:c}},c.raiseRowClicked=function(a,b){var d=c.calcDate(c.getOffset(a).x);c.onRowClicked({event:{row:b.clone(),column:c.gantt.getColumn(d),date:d}}),a.stopPropagation(),a.preventDefault()},c.raiseRowUpdated=function(a){c.onRowUpdated({event:{row:a.clone()}})},c.raiseScrollEvent=function(){var a,d,f,g=c.ganttScroll[0],h=null;0===g.scrollLeft?(h="left",a=b.clone(c.gantt.getFirstColumn().fromDate)):g.offsetWidth+g.scrollLeft>=g.scrollWidth&&(h="right",a=b.clone(c.gantt.getLastColumn().fromDate)),null!==h&&e(function(){c.autoExpandColumns(g,d,f),c.onScroll({event:{date:a,position:h}})},500,!0)},c.raiseTaskClicked=function(a,b,d){var e=b.clone();c.onTaskClicked({event:{row:e,task:e.tasksMap[d.id]}}),a.stopPropagation(),a.preventDefault()},c.ganttScroll=angular.element(d.children()[2]),c.ganttScroll.bind("scroll",c.raiseScrollEvent),c.setData=function(a){for(var b=c.ganttScroll[0],d=c.gantt.columns.length>0?c.gantt.getLastColumn().fromDate-c.gantt.getFirstColumn().fromDate:1,e=b.scrollWidth,f=0,g=a.length;g>f;f++){var h=a[f],i=c.gantt.addRow(h),j=c.gantt.rowsMap[h.id];i===!0?c.raiseRowUpdated(j):c.raiseRowAdded(j)}if(c.fromDate||c.toDate){var k=c.fromDate?c.fromDate:c.gantt.getFirstColumn().fromDate,l=c.toDate?c.toDate:c.gantt.getLastColumn().fromDate;c.gantt.expandColumnRange(k,l)}c.updateBounds(),c.sortRows(),b.scrollLeft=0===b.scrollLeft&&c.gantt.columns.length>0?(c.gantt.getLastColumn().fromDate-c.gantt.getFirstColumn().fromDate)*e/d-e:b.scrollLeft},c.loadData({fn:c.setData}),c.removeData({fn:function(a){for(var b=0,d=a.length;d>b;b++){var e=a[b];if(void 0!==e.tasks&&e.tasks.length>0){if(e.id in c.gantt.rowsMap){for(var f=c.gantt.rowsMap[e.id],g=0,h=e.tasks.length;h>g;g++)f.removeTask(e.tasks[g].id);c.raiseRowUpdated(f)}}else c.gantt.removeRow(e.id)}c.updateBounds(),c.sortRows()}}),c.removeAllData=function(){c.gantt.removeRows(),c.updateBounds()},c.clearData({fn:c.removeAllData}),c.onGanttReady()}]}}]),gantt.factory("Column",[function(){var a=function(b,c){var d=this;d.fromDate=b,d.toDate=c,d.clone=function(){var b=new a(d.fromDate,d.toDate);return b.isWeekend=d.isWeekend,b.widthDay=d.widthDay,b.widthWeek=d.widthWeek,b.widthMonth=d.widthMonth,b}};return a}]),gantt.service("dateFunctions",[function(){return{firstDayOfWeek:1,isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(a){return"string"==typeof a||"object"==typeof a&&a.constructor===String},clone:function(a){return this.isString(a)?new Date(Date.parse(a)):this.isNumber(a)?new Date(a):new Date(a.getTime())},setTimeZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setHours(0),c.setMinutes(0),c.setMilliseconds(0),c},setToFirstDayOfMonth:function(a,b){var c=b===!0?this.clone(a):a;return c.setDate(1),c},setToDayOfWeek:function(a,b,c){var d=c===!0?this.clone(a):a;if(d.getDay()===b)return d;var e=-1,f=(b-d.getDay()+7*(e||1))%7;return this.addDays(d,0===f?f+=7*(e||1):f)},addMonths:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(1),d.setMonth(d.getMonth()+b),d},addWeeks:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+7*b),d},addDays:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+b),d},addHours:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setHours(a.getHours()+b),d},addMinutes:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMinutes(a.getMinutes()+b),d},addMilliseconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMilliseconds(a.getMilliseconds()+b),d},getWeek:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),2>=c?(e=b-1,f=(0|e/4)-(0|e/100)+(0|e/400),g=(0|(e-1)/4)-(0|(e-1)/100)+(0|(e-1)/400),m=f-g,i=0,j=d-1+31*(c-1)):(e=b,f=(0|e/4)-(0|e/100)+(0|e/400),g=(0|(e-1)/4)-(0|(e-1)/100)+(0|(e-1)/400),m=f-g,i=m+1,j=d+(153*(c-3)+2)/5+58+m),k=(e+f)%7,h=(j+k-i)%7,l=0|j+3-h,n=0>l?53-(0|(k-m)/5):l>364+m?1:(0|l/7)+1,b=c=d=null,n}}}]),gantt.factory("Gantt",["Row","Column","dateFunctions",function(a,b,c){var d=function(){var d=this;d.columns=[],d.rowsMap={},d.rows=[],d.highestRowOrder=0,d.getFirstColumn=function(){return d.columns[0]},d.getColumn=function(a){for(var b=0;b<d.columns.length;b++){var c=d.columns[b];if(c.fromDate<=a&&c.toDate>=a)return c}return null},d.getLastColumn=function(){return d.columns[d.columns.length-1]};var e=function(a,e){for(var f=c.clone(a);e>=f;)for(var g=0;24>g;g++){var h=new b(c.clone(f),c.addMilliseconds(c.addHours(f,1,!0),-1,!1));d.columns.push(h);var i=f.getTime();c.addHours(f,1),f.getTime()===i&&c.addHours(f,2)}d.columns.sort(function(a,b){return a.fromDate>b.fromDate?1:-1})};d.expandColumnRange=function(a,b){(0===d.columns.length||a<d.getFirstColumn().fromDate)&&e(c.setTimeZero(a,!0),0===d.columns.length?c.setTimeZero(b,!0):c.addMilliseconds(d.getFirstColumn().fromDate,-1,!0)),b>d.getLastColumn().fromDate&&e(c.addHours(d.getLastColumn().fromDate,1,!0),c.setTimeZero(b,!0))},d.addRow=function(b){var c,e=!1;if(b.id in d.rowsMap)c=d.rowsMap[b.id],c.copy(b),e=!0;else{var f=b.order;void 0===f&&(f=d.highestRowOrder),f>=d.highestRowOrder&&(d.highestRowOrder=f+1),c=new a(b.id,b.description,f,b.data),d.rowsMap[b.id]=c,d.rows.push(c)}if(void 0!==b.tasks)for(var g=0,h=b.tasks.length;h>g;g++){var i=c.addTask(b.tasks[g]);d.expandColumnRange(i.from,i.to)}return e},d.removeRow=function(a){if(a in d.rowsMap){delete d.rowsMap[a];for(var b=0,c=d.rows.length;c>b;b++){var e=d.rows[b];if(e.id===a)return d.rows.splice(b,1),e}}},d.removeRows=function(){d.columns=[],d.rowsMap={},d.rows=[],d.highestRowOrder=0},d.swapRows=function(a,b){var c=a.order;a.order=b.order,b.order=c};var f=function(a,b){return void 0===a.minFromDate&&void 0===b.minFromDate?g(a,b):void 0===a.minFromDate?1:void 0===b.minFromDate?-1:a.minFromDate-b.minFromDate},g=function(a,b){return a.description===b.description?0:a.description<b.description?-1:1},h=function(a,b){return void 0===a.order&&void 0===b.order?g(a,b):void 0===a.order?1:void 0===b.order?-1:a.order-b.order};d.sortRows=function(a){switch(a){case"name":d.rows.sort(g);break;case"custom":d.rows.sort(h);break;default:d.rows.sort(f)}}};return d}]),gantt.factory("Row",["Task","dateFunctions",function(a,b){var c=function(d,e,f,g){var h=this;h.id=d,h.description=e,h.order=f,h.tasksMap={},h.tasks=[],h.data=g,h.addTask=function(b){var c;return b.id in h.tasksMap?(c=h.tasksMap[b.id],c.copy(b)):(c=new a(b.id,b.subject,b.color,b.from,b.to,b.data),h.tasksMap[b.id]=c,h.tasks.push(c)),h.findEarliestFromDate(c),c},h.removeTask=function(a){if(a in h.tasksMap){delete h.tasksMap[a];for(var b=0,c=h.tasks.length;c>b;b++){var d=h.tasks[b];if(d.id===a){if(h.tasks.splice(b,1),0===h.minFromDate-d.from){h.minFromDate=void 0;for(var e=0,f=h.tasks.length;f>e;e++)h.findEarliestFromDate(h.tasks[e])}return d}}}},h.findEarliestFromDate=function(a){void 0===h.minFromDate?h.minFromDate=b.clone(a.from):a.from<h.minFromDate&&(h.minFromDate=b.clone(a.from))},h.copy=function(a){h.description=a.description,h.data=a.data,void 0!==a.order&&(h.order=a.order)},h.clone=function(){for(var a=new c(h.id,h.description,h.order,h.data),b=0,d=h.tasks.length;d>b;b++)a.addTask(h.tasks[b].clone());return a}};return c}]),gantt.factory("Task",["dateFunctions",function(a){var b=function(c,d,e,f,g,h){var i=this;i.id=c,i.subject=d,i.color=e,i.from=a.clone(f),i.to=a.clone(g),i.data=h,i.copy=function(b){i.subject=b.subject,i.color=b.color,i.from=a.clone(b.from),i.to=a.clone(b.to),i.data=b.data},i.clone=function(){return new b(i.id,i.subject,i.color,i.from,i.to,i.data)}};return b}]),gantt.filter("ganttDateWeek",["dateFunctions",function(a){return function(b){return a.getWeek(b)}}]),gantt.directive("ganttHorizontalScrollReceiver",["scroller",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.horizontal.push(c[0])}]}}]),gantt.directive("ganttScrollSender",["scroller",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){b.el=c[0],b.updateListeners=function(){var c,d;for(c=0,d=a.vertical.length;d>c;c++)a.vertical[c].style.top=-b.el.scrollTop+"px";for(c=0,d=a.vertical.length;d>c;c++)a.horizontal[c].style.left=-b.el.scrollLeft+"px"},c.bind("scroll",b.updateListeners)}]}}]),gantt.service("scroller",[function(){return{vertical:[],horizontal:[]}}]),gantt.directive("ganttSortable",["$document","sortableState",function(a,b){return{restrict:"E",template:"<div ng-transclude></div>",replace:!0,transclude:!0,scope:{row:"=ngModel",swap:"&"},controller:["$scope","$element",function(c,d){d.bind("mousedown",function(){f();var b=function(){angular.element(a[0].body).unbind("mouseup",b),g()};angular.element(a[0].body).bind("mouseup",b)}),d.bind("mousemove",function(d){if(e()){var f=angular.element(a[0].elementFromPoint(d.clientX,d.clientY)),g=f.controller("ngModel").$modelValue;c.$apply(function(){c.swap({a:g,b:b.startRow})})}});var e=function(){return void 0!==b.startRow&&!angular.equals(c.row,b.startRow)},f=function(){b.startRow=c.row,d.css("cursor","move"),angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})},g=function(){b.startRow=void 0,d.css("cursor","pointer"),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]),gantt.service("sortableState",[function(){return{startRow:void 0}}]),gantt.directive("ganttTooltip",["dateFilter","$timeout","$document",function(a,b,c){return{restrict:"E",template:"<div ng-mouseenter='mouseEnter($event)' ng-mouseleave='mouseLeave($event)'><div ng-show='visible' class='gantt-task-info' ng-style='css'><div class='gantt-task-info-content'>{{ task.subject }}</br><small>{{ task.to - task.from === 0 && (task.from | date:'MMM d, HH:mm') || (task.from | date:'MMM d, HH:mm') + ' - ' + (task.to | date:'MMM d, HH:mm') }}</small></div></div><div ng-transclude></div></div>",replace:!0,transclude:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a,d){a.visible=!1,a.css={},a.mouseEnter=function(c){a.visible=!0,b(function(){var b=angular.element(d.children()[0]);b.removeClass("gantt-task-infoArrow"),b.removeClass("gantt-task-infoArrowR"),c.clientX+b[0].offsetWidth>a.getViewPortWidth()?(a.css.left=c.clientX+20-b[0].offsetWidth+"px",b.addClass("gantt-task-infoArrowR")):(a.css.left=c.clientX-20+"px",b.addClass("gantt-task-infoArrow")),a.css.top=d[0].getBoundingClientRect().top+"px",a.css.marginTop=-b[0].offsetHeight-8+"px",a.css.opacity=1},1,!0)},a.mouseLeave=function(){a.css.opacity=0,a.visible=!1},a.getViewPortWidth=function(){var a=c[0];return a.documentElement.clientWidth||a.documentElement.getElementById("body")[0].clientWidth}}]}}]),gantt.directive("ganttVerticalScrollReceiver",["scroller",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.vertical.push(c[0])}]}}]);