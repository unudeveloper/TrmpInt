'use strict';
gantt.factory('GanttColumn', [ 'moment', function(moment) {
    // Used to display the Gantt grid and header.
    // The columns are generated by the column generator.

    var Column = function(date, unit, left, width) {
        var self = this;

        self.date = moment(date).startOf(unit);
        self.endDate = moment(self.date).add(1, unit);
        self.widthDuration = self.endDate.diff(self.date, 'milliseconds');
        self.unit = unit;
        self.left = left;
        self.width = width;

        self.clone = function() {
            return new Column(self.date.clone(), self.unit, self.left, self.width);
        };

        self.containsDate = function(date) {
            return moment(date) > self.date && moment(date) <= self.endDate;
        };

        self.equals = function(other) {
            return self.date === other.date;
        };

        self.getDateByPosition = function(position) {
            if (position < 0) {
                position = 0;
            }
            if (position > self.width) {
                position = self.width;
            }

            var positionDuration = self.widthDuration / self.width * position;
            var date = moment(self.date).add(positionDuration, 'milliseconds');
            return date;
        };

        self.getPositionByDate = function(date) {
            var positionDuration = date.diff(self.date, 'milliseconds');
            var position = positionDuration / self.widthDuration * self.width;
            return self.left + position;
        };
    };
    return Column;
}]);
