gantt.factory('Column', [ 'dateFunctions', function (df) {
    // Used to display the Gantt grid and header.
    // The columns are generated by the column generator.

    var Column = function(date, left, width) {
        var self = this;
        self.date = date;
        self.left = left;
        self.width = width;

        self.clone = function() {
            return new Column(self.date, self.left, self.width);
        };

        self.equals = function(other) {
            return self.date === other.date;
        };
    };

    var MonthColumn = function(date, left, width) {
        var column = new Column(date, left, width);

        column.clone = function() {
            return new Column(column.date, column.left, column.width);
        };

        column.getDateByPosition = function(position) {
            if (position < 0) position = 0;
            if (position > column.width) position = column.width;

            var res = df.clone(column.date);
            res.setDate(1 + df.getDaysInMonth(column.date)/column.width * position);
            return res;
        };

        return column;
    };

    var WeekColumn = function(date, left, width) {
        var column = new Column(date, left, width);
        column.week = df.getWeek(date);

        column.clone = function() {
            var copy = new Column(column.date, column.left, column.width);
            copy.week = column.week;
            return copy;
        };

        column.getDateByPosition = function(position) {
            if (position < 0) position = 0;
            if (position > column.width) position = column.width;

            var res = df.clone(column.date);
            df.setToDayOfWeek(res, 7/column.width * position, false);
            return res;
        };

        return column;
    };

    var DayColumn = function(date, left, width, isWeekend) {
        var column = new Column(date, left, width);
        column.isWeekend = isWeekend;

        column.clone = function() {
            var copy = new Column(column.date, column.left, column.width);
            copy.isWeekend = column.isWeekend;
            return copy;
        };

        column.getDateByPosition = function(position) {
            if (position < 0) position = 0;
            if (position > column.width) position = column.width;

            var res = df.clone(column.date);
            res.setHours(24/column.width * position);
            return res;
        };

        return column;
    };

    var HourColumn = function(date, left, width, isWeekend, isWorkHour) {
        var column = new Column(date, left, width);
        column.isWeekend = isWeekend;
        column.isWorkHour = isWorkHour;

        column.clone = function() {
            var copy = new Column(column.date, column.left, column.width);
            copy.isWeekend = column.isWeekend;
            copy.isWorkHour = column.isWorkHour;
            return copy;
        };

        column.getDateByPosition = function(position) {
            if (position < 0) position = 0;
            if (position > column.width) position = column.width;

            var res = df.clone(column.date);
            res.setMinutes(60/column.width * position);
            return res;
        };

        return column;
    };

    return {
        Hour: HourColumn,
        Day: DayColumn,
        Week: WeekColumn,
        Month: MonthColumn
    };
}]);